{
  "version": "0.7.1",
  "meta": {
    "version": "1.0.0",
    "lastUpdated": "2026-02-19T07:08:06.558Z"
  },
  "workUnits": {
    "FOUND-001": {
      "id": "FOUND-001",
      "title": "Conduct Foundation Event Storm for Foundation",
      "status": "done",
      "createdAt": "2026-02-18T20:19:20.688Z",
      "updatedAt": "2026-02-18T20:41:21.686Z",
      "stateHistory": [
        {
          "state": "backlog",
          "timestamp": "2026-02-18T20:19:20.688Z"
        },
        {
          "state": "specifying",
          "timestamp": "2026-02-18T20:35:49.605Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-18T20:37:58.068Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-18T20:38:02.005Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-18T20:38:05.778Z"
        }
      ],
      "description": "Complete the foundation by capturing domain architecture through Foundation Event Storm.\n\nUse these commands to populate foundation.json eventStorm field:\n- fspec add-foundation-bounded-context <name>\n- fspec add-aggregate-to-foundation <context> <aggregate>\n- fspec add-domain-event-to-foundation <context> <event>\n- fspec show-foundation-event-storm\n\nWhy this matters:\n- Establishes bounded contexts for domain-driven design\n- Enables tag ontology generation from domain model\n- Provides foundation for architectural documentation\n- Supports EXMAP-004 tag discovery workflow\n\nSee spec/CLAUDE.md \"Foundation Event Storm\" section for detailed guidance.",
      "type": "task",
      "rules": [],
      "examples": [],
      "questions": [],
      "architectureNotes": [],
      "nextRuleId": 0,
      "nextExampleId": 0,
      "nextQuestionId": 0,
      "nextNoteId": 0,
      "updated": "2026-02-18T20:38:05.778Z",
      "attachments": [
        "spec/attachments/FOUND-001/architecture-notes-part1.md",
        "spec/attachments/FOUND-001/architecture-notes-part2.md",
        "spec/attachments/FOUND-001/architecture-notes-part3.md",
        "spec/attachments/FOUND-001/architecture-notes-part4.md",
        "spec/attachments/FOUND-001/architecture-notes-part5.md"
      ]
    },
    "SETUP-001": {
      "id": "SETUP-001",
      "title": "Set up Flutter app with modern 2026 architecture",
      "type": "task",
      "status": "done",
      "createdAt": "2026-02-18T20:49:44.049Z",
      "updatedAt": "2026-02-18T21:00:07.598Z",
      "description": "Initialize the fspec Mobile Flutter application with a production-ready architecture using modern best practices.",
      "children": [],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-18T20:49:56.900Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-18T20:51:33.830Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-18T20:59:58.754Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-18T21:00:07.598Z"
        }
      ],
      "rules": [
        {
          "id": 0,
          "text": "Use FVM (Flutter Version Manager) for version management - install via `brew tap leoafarias/fvm && brew install fvm`",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:00.776Z"
        },
        {
          "id": 1,
          "text": "Use Riverpod 2.6+ for state management with code generation (flutter_riverpod, riverpod_annotation, riverpod_generator)",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:02.558Z"
        },
        {
          "id": 2,
          "text": "Use GoRouter 14.8+ for type-safe navigation",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:02.716Z"
        },
        {
          "id": 3,
          "text": "Use Freezed 3.0+ for immutable state classes",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:03.354Z"
        },
        {
          "id": 4,
          "text": "Use Dio 5.8+ for HTTP/WebSocket networking",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:04.033Z"
        },
        {
          "id": 5,
          "text": "Use Clean Architecture with feature-based folder structure (data/domain/presentation layers)",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:04.831Z"
        },
        {
          "id": 6,
          "text": "Configure stitch-mcp for Google Stitch integration - requires Google Cloud project with Stitch API enabled",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:09.520Z"
        },
        {
          "id": 7,
          "text": "Use dev/staging/prod flavors for environment management",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:10.336Z"
        },
        {
          "id": 8,
          "text": "Use Material 3 design with Google Fonts 6.2+",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:11.358Z"
        }
      ],
      "nextRuleId": 9,
      "examples": [
        {
          "id": 0,
          "text": "Flutter SDK installed via FVM with latest stable version (3.32+)",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:12.312Z"
        },
        {
          "id": 1,
          "text": "Project created with `flutter create --org com.fspec fspec_mobile`",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:13.074Z"
        },
        {
          "id": 2,
          "text": "Running `flutter doctor` shows all green checkmarks for iOS and Android",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:14.261Z"
        }
      ],
      "nextExampleId": 3,
      "architectureNotes": [
        {
          "id": 0,
          "text": "SYSTEM REQUIREMENTS: macOS with Homebrew, Xcode (for iOS), Android Studio (for Android), VS Code or Android Studio IDE",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:18.863Z"
        },
        {
          "id": 1,
          "text": "GOOGLE STITCH MCP: Requires `gcloud` CLI, Google Cloud project, and `gcloud beta services mcp enable stitch.googleapis.com`",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:20.286Z"
        },
        {
          "id": 2,
          "text": "STITCH MCP TOOLS: extract_design_context, fetch_screen_code, fetch_screen_image, generate_screen_from_text, create_project, list_projects, list_screens",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:22.032Z"
        },
        {
          "id": 3,
          "text": "REFERENCE TEMPLATE: https://github.com/Erengun/Flutter-Riverpod-Quickstart-Template - 2025 Edition production-ready template",
          "deleted": false,
          "createdAt": "2026-02-18T20:50:23.402Z"
        }
      ],
      "nextNoteId": 4,
      "attachments": [
        "spec/attachments/SETUP-001/flutter-setup-guide.md"
      ],
      "questions": [],
      "nextQuestionId": 0,
      "updated": "2026-02-18T21:00:07.598Z"
    },
    "DESIGN-001": {
      "id": "DESIGN-001",
      "title": "Set up Google Stitch integration for UI design workflow",
      "type": "task",
      "status": "done",
      "createdAt": "2026-02-18T23:38:57.120Z",
      "updatedAt": "2026-02-19T00:08:58.781Z",
      "description": "Interactively configure Google Stitch (stitch.withgoogle.com) for generating UI designs and converting them to Flutter code. This includes:\n\n1. **Stitch Account Setup**\n   - Create/access Google Stitch at stitch.withgoogle.com\n   - Configure project design system (colors, typography, components)\n\n2. **Stitch MCP Server Integration**\n   - Install and configure Stitch MCP Server for real-time AI integration\n   - Set up connection with development environment (VS Code/Cursor)\n\n3. **Gemini CLI Extension**\n   - Install Gemini CLI extension for terminal-based workflows\n   - Configure AI-driven design prompts aligned with app branding\n\n4. **Agent Skills Configuration**\n   - Set up Design MD skill for design documentation\n   - Configure React Components skill (for conversion reference)\n\n5. **Flutter Conversion Workflow**\n   - Document process for converting Stitch designs to Flutter\n   - Set up AI-assisted React-to-Flutter conversion pipeline\n   - Integrate with existing Riverpod/Freezed architecture\n\n6. **Design System Sync**\n   - Export color palette, typography, and themes from Stitch\n   - Create corresponding Flutter ThemeData and design tokens\n\nResources:\n- Stitch: https://stitch.withgoogle.com\n- Google Developers Blog: https://developers.googleblog.com/en/stitch-a-new-way-to-design-uis/\n- MCP/CLI Guide: https://www.geeky-gadgets.com/google-stitch-mcp-gemini-agent-skills/",
      "children": [],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-18T23:39:32.076Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-18T23:39:36.616Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T00:08:53.040Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T00:08:58.782Z"
        }
      ],
      "rules": [],
      "examples": [],
      "questions": [],
      "architectureNotes": [],
      "nextRuleId": 0,
      "nextExampleId": 0,
      "nextQuestionId": 0,
      "nextNoteId": 0,
      "updated": "2026-02-19T00:08:58.782Z"
    },
    "MOBILE-001": {
      "id": "MOBILE-001",
      "title": "Connection Data Model and Local Storage",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:21.444Z",
      "updatedAt": "2026-02-19T00:22:56.497Z",
      "description": "Define the Connection entity (name, relay URL, channel ID, API key, status) and persist connections locally using Hive. This is the foundational data layer that all other features depend on.",
      "epic": "mobile-core",
      "children": [],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T00:10:49.666Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T00:14:28.171Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T00:17:32.489Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T00:22:01.406Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T00:22:56.497Z"
        }
      ],
      "userStory": {
        "role": "mobile developer",
        "action": "store and retrieve fspec instance connections locally",
        "benefit": "my connections persist across app restarts and I can manage multiple instances"
      },
      "rules": [
        {
          "id": 0,
          "text": "A Connection must have a unique identifier (UUID)",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:06.028Z"
        },
        {
          "id": 1,
          "text": "A Connection must have a non-empty display name",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:11.003Z"
        },
        {
          "id": 2,
          "text": "A Connection must have a valid relay server URL (https scheme)",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:15.240Z"
        },
        {
          "id": 3,
          "text": "A Connection must have a channel ID",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:19.809Z"
        },
        {
          "id": 4,
          "text": "API key is optional (some relays may not require authentication)",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:25.203Z"
        },
        {
          "id": 5,
          "text": "Connections are persisted locally using Hive encrypted storage",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:29.753Z"
        },
        {
          "id": 6,
          "text": "Connection status tracks: disconnected, connecting, connected, error",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:34.381Z"
        }
      ],
      "nextRuleId": 7,
      "examples": [
        {
          "id": 0,
          "text": "Creating connection with name 'Work MacBook', URL 'https://relay.fspec.dev', channel 'abc-123' succeeds",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:40.097Z"
        },
        {
          "id": 1,
          "text": "Creating connection without API key succeeds (API key is optional)",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:44.516Z"
        },
        {
          "id": 2,
          "text": "Creating connection with empty name fails with validation error",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:48.763Z"
        },
        {
          "id": 3,
          "text": "Creating connection with http:// URL fails (must be https)",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:53.680Z"
        },
        {
          "id": 4,
          "text": "Saved connections are available after app restart",
          "deleted": false,
          "createdAt": "2026-02-19T00:11:58.256Z"
        },
        {
          "id": 5,
          "text": "Updating a connection's name persists the change",
          "deleted": false,
          "createdAt": "2026-02-19T00:12:02.923Z"
        },
        {
          "id": 6,
          "text": "Deleting a connection removes it from storage permanently",
          "deleted": false,
          "createdAt": "2026-02-19T00:12:07.644Z"
        },
        {
          "id": 7,
          "text": "Listing connections returns all saved connections in order of creation",
          "deleted": false,
          "createdAt": "2026-02-19T00:12:12.477Z"
        }
      ],
      "nextExampleId": 8,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Use Freezed for immutable Connection model with JSON serialization. Use Hive with hive_ce for local storage. Create ConnectionRepository with Riverpod provider.",
          "deleted": false,
          "createdAt": "2026-02-19T00:12:18.457Z"
        }
      ],
      "nextNoteId": 1,
      "estimate": 3,
      "attachments": [
        "spec/attachments/MOBILE-001/ast-research-existing-code.md"
      ],
      "questions": [],
      "nextQuestionId": 0,
      "updated": "2026-02-19T00:22:56.497Z"
    },
    "MOBILE-002": {
      "id": "MOBILE-002",
      "title": "Add Connection Screen",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:23.069Z",
      "updatedAt": "2026-02-19T01:06:48.187Z",
      "description": "UI screen for adding a new fspec instance connection. Form with connection name, relay URL, channel ID, optional API key. Includes QR code scanner for quick setup and connection testing.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-001"
      ],
      "attachments": [
        "spec/attachments/MOBILE-002/add-connection.png",
        "spec/attachments/MOBILE-002/ast-research-existing-code.md"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T00:33:14.676Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T00:42:26.424Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T00:47:58.852Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T01:05:03.668Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T01:06:48.187Z"
        }
      ],
      "userStory": {
        "role": "mobile user",
        "action": "add a new fspec instance connection",
        "benefit": "monitor and interact with my CLI sessions remotely"
      },
      "rules": [
        {
          "id": 0,
          "text": "Connection Name is required and cannot be empty",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:29.914Z"
        },
        {
          "id": 1,
          "text": "Relay Server URL must use https:// scheme",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:30.683Z"
        },
        {
          "id": 2,
          "text": "Channel ID is required",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:31.607Z"
        },
        {
          "id": 3,
          "text": "API Key is optional",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:32.099Z"
        },
        {
          "id": 4,
          "text": "QR code scanner can auto-populate all form fields from desktop",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:33.118Z"
        },
        {
          "id": 5,
          "text": "API Key field has a visibility toggle (show/hide password)",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:33.910Z"
        },
        {
          "id": 6,
          "text": "Cancel button returns to previous screen without saving",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:34.796Z"
        },
        {
          "id": 7,
          "text": "Save button validates form and persists connection if valid",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:35.720Z"
        },
        {
          "id": 8,
          "text": "URL scheme format: fspec://connect?n=Name&r=RelayURL&c=ChannelID&k=APIKey (k is optional)",
          "deleted": false,
          "createdAt": "2026-02-19T00:36:36.192Z"
        },
        {
          "id": 9,
          "text": "Invalid QR shows toast and stays on scanner. Missing fields partially fill form with toast to complete manually. Camera denied shows Settings button. Manual entry is always the fallback.",
          "deleted": false,
          "createdAt": "2026-02-19T00:38:18.136Z"
        }
      ],
      "nextRuleId": 10,
      "examples": [
        {
          "id": 0,
          "text": "User enters 'Work MacBook', 'https://relay.fspec.dev', channel 'abc-123' and taps Save - connection is created and user returns to connections list",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:42.051Z"
        },
        {
          "id": 1,
          "text": "User scans QR code from desktop CLI - all fields auto-populate with connection details",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:42.924Z"
        },
        {
          "id": 2,
          "text": "User leaves Connection Name empty and taps Save - sees validation error 'Connection name is required'",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:44.122Z"
        },
        {
          "id": 3,
          "text": "User enters 'http://relay.example.com' as URL and taps Save - sees validation error 'URL must use https'",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:45.219Z"
        },
        {
          "id": 4,
          "text": "User leaves Channel ID empty and taps Save - sees validation error 'Channel ID is required'",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:45.971Z"
        },
        {
          "id": 5,
          "text": "User fills form without API key and saves - connection is created successfully (API key optional)",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:47.167Z"
        },
        {
          "id": 6,
          "text": "User taps Cancel button - returns to previous screen without creating connection",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:47.992Z"
        },
        {
          "id": 7,
          "text": "User taps eye icon on API Key field - toggles between hidden (dots) and visible text",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:49.033Z"
        }
      ],
      "nextExampleId": 8,
      "questions": [
        {
          "id": 0,
          "text": "@human: What format is the QR code data? JSON with fields, or a URL scheme?",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:55.633Z",
          "selected": true,
          "answered": true,
          "answer": "URL scheme format: fspec://connect?n=Name&r=RelayURL&c=ChannelID&k=APIKey (k is optional)"
        },
        {
          "id": 1,
          "text": "@human: Should there be a 'Test Connection' button to verify connectivity before saving?",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:56.620Z",
          "selected": true,
          "answered": true,
          "answer": "No - just Cancel and Save buttons. Connection testing happens elsewhere."
        },
        {
          "id": 2,
          "text": "@human: What happens if QR code scan fails or contains invalid data?",
          "deleted": false,
          "createdAt": "2026-02-19T00:33:57.928Z",
          "selected": true,
          "answered": true,
          "answer": "Invalid QR shows toast and stays on scanner. Missing fields partially fill form with toast to complete manually. Camera denied shows Settings button. Manual entry is always the fallback."
        }
      ],
      "nextQuestionId": 3,
      "estimate": 5,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Screen built as AddConnectionScreen widget using Riverpod for state. Form uses Flutter Form widget with TextFormField validators. QR scanning via mobile_scanner package. Parses fspec:// URL scheme. Saves via ConnectionRepository (from MOBILE-001). Navigation with go_router.",
          "deleted": false,
          "createdAt": "2026-02-19T00:39:24.997Z"
        }
      ],
      "nextNoteId": 1,
      "updated": "2026-02-19T01:06:48.187Z"
    },
    "MOBILE-003": {
      "id": "MOBILE-003",
      "title": "Instance Dashboard",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:24.258Z",
      "updatedAt": "2026-02-19T01:44:08.635Z",
      "description": "Main dashboard screen listing all configured fspec instance connections. Shows connection status (online/offline/syncing), instance name, project name, and recent activity preview. Supports navigation to instance detail.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-001"
      ],
      "attachments": [
        "spec/attachments/MOBILE-003/dashboard-thumbnail.png",
        "spec/attachments/MOBILE-003/ast-research-connection-model.md"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T01:21:39.629Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T01:35:41.424Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T01:38:14.403Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T01:43:42.301Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T01:44:08.635Z"
        }
      ],
      "userStory": {
        "role": "mobile app user",
        "action": "view a dashboard of all my fspec instance connections",
        "benefit": "quickly see status and activity across all my projects"
      },
      "rules": [
        {
          "id": 0,
          "text": "Each instance card shows: instance name, connection status (online/offline/syncing), time since last activity, and project name",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:02.872Z"
        },
        {
          "id": 1,
          "text": "Each instance card shows an activity preview with the most recent AI output, error, or status message",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:04.111Z"
        },
        {
          "id": 2,
          "text": "Connection status is indicated with colored dots: green for ONLINE, red for OFFLINE, and a distinct indicator for SYNCING",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:05.852Z"
        },
        {
          "id": 3,
          "text": "Instance list auto-refreshes to show real-time status updates",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:05.941Z"
        },
        {
          "id": 4,
          "text": "Tapping an instance card navigates to the instance detail view",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:06.816Z"
        },
        {
          "id": 5,
          "text": "Each card has a context-sensitive action button based on instance state (View Details, Retry, Open Staging, etc.)",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:08.212Z"
        },
        {
          "id": 6,
          "text": "connected→ONLINE, disconnected→OFFLINE, connecting→SYNCING, error→OFFLINE (with error indicator)",
          "deleted": false,
          "createdAt": "2026-02-19T01:26:41.904Z"
        },
        {
          "id": 7,
          "text": "Project name received from fspec instance via WebSocket when connected. Store as lastKnownProjectName on Connection model to display when offline.",
          "deleted": false,
          "createdAt": "2026-02-19T01:27:49.787Z"
        },
        {
          "id": 8,
          "text": "Activity preview from WebSocket session stream. Cache on Connection: lastActivityType (aiOutput/error/status), lastActivityContent (truncated preview), lastActivityAt (timestamp for relative display).",
          "deleted": false,
          "createdAt": "2026-02-19T01:28:07.447Z"
        },
        {
          "id": 9,
          "text": "Dashboard displays summary stat showing active instances count",
          "deleted": false,
          "createdAt": "2026-02-19T01:32:18.005Z"
        }
      ],
      "nextRuleId": 10,
      "examples": [
        {
          "id": 0,
          "text": "User opens dashboard with 3 connections: MacBook Pro (online, fspec-core), Ubuntu Server (offline, api-gateway), Development VM (online, mobile-ui) - sees all cards with correct status colors",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:14.965Z"
        },
        {
          "id": 1,
          "text": "MacBook Pro card shows AI OUTPUT SNIPPET: 'Optimized 3 functions in core module. Reduced latency by 12%...' with 'View Details' button",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:17.977Z"
        },
        {
          "id": 2,
          "text": "Ubuntu Server card shows CRITICAL FAILURE in red: 'Build failed at step 4: dependency conflict...' with 'Retry Deployment' button",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:19.497Z"
        },
        {
          "id": 3,
          "text": "User opens dashboard with no connections configured - sees empty state with prompt to add first connection",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:20.515Z"
        },
        {
          "id": 4,
          "text": "User taps on MacBook Pro card - navigates to instance detail view for that connection",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:21.637Z"
        },
        {
          "id": 5,
          "text": "User sees summary stat showing '3' active instances at top of screen",
          "deleted": false,
          "createdAt": "2026-02-19T01:32:25.192Z"
        }
      ],
      "nextExampleId": 6,
      "questions": [
        {
          "id": 0,
          "text": "@human: The Connection model has status enum (disconnected/connecting/connected/error) but design shows ONLINE/OFFLINE/SYNCING. How should these map?",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:29.534Z",
          "selected": true,
          "answered": true,
          "answer": "connected→ONLINE, disconnected→OFFLINE, connecting→SYNCING, error→OFFLINE (with error indicator)"
        },
        {
          "id": 1,
          "text": "@human: Connection model has no projectName field - where does the project name displayed on cards come from?",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:30.661Z",
          "selected": true,
          "answered": true,
          "answer": "Project name received from fspec instance via WebSocket when connected. Store as lastKnownProjectName on Connection model to display when offline."
        },
        {
          "id": 2,
          "text": "@human: Activity preview data (AI output snippets, errors, status messages) - where does this come from? Need a separate activity/message model?",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:31.909Z",
          "selected": true,
          "answered": true,
          "answer": "Activity preview from WebSocket session stream. Cache on Connection: lastActivityType (aiOutput/error/status), lastActivityContent (truncated preview), lastActivityAt (timestamp for relative display)."
        },
        {
          "id": 3,
          "text": "@human: What defines 'failed jobs' for the summary stat? Is this related to CRITICAL FAILURE messages?",
          "deleted": false,
          "createdAt": "2026-02-19T01:22:33.308Z",
          "selected": true,
          "answered": true,
          "answer": "Deferred - failed jobs stat not needed for initial implementation. Can add later if required."
        }
      ],
      "nextQuestionId": 4,
      "estimate": 5,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Extend Connection model with fields: lastKnownProjectName, lastActivityType (enum: aiOutput/error/status), lastActivityContent, lastActivityAt",
          "deleted": false,
          "createdAt": "2026-02-19T01:34:29.582Z"
        },
        {
          "id": 1,
          "text": "Create DashboardScreen widget with Riverpod provider watching connection list from repository",
          "deleted": false,
          "createdAt": "2026-02-19T01:34:34.092Z"
        },
        {
          "id": 2,
          "text": "Create InstanceCard widget displaying status indicator, project name, activity preview, and context-sensitive action button",
          "deleted": false,
          "createdAt": "2026-02-19T01:34:38.282Z"
        }
      ],
      "nextNoteId": 3,
      "updated": "2026-02-19T01:44:08.635Z"
    },
    "MOBILE-004": {
      "id": "MOBILE-004",
      "title": "WebSocket Relay Connection",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:25.851Z",
      "updatedAt": "2026-02-19T02:10:46.828Z",
      "description": "Establish and maintain WebSocket connection to the relay server. Handle connection lifecycle (connect, disconnect, reconnect), authentication handshake, and connection state management with Riverpod.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-001"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T01:52:10.067Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T01:58:48.706Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T02:02:35.692Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T02:10:07.758Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T02:10:46.828Z"
        }
      ],
      "userStory": {
        "role": "mobile user",
        "action": "connect to my fspec relay server",
        "benefit": "interact with my fspec sessions remotely"
      },
      "rules": [
        {
          "id": 0,
          "text": "Connection requires relay URL, channel ID, and optional API key",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:45.318Z"
        },
        {
          "id": 1,
          "text": "Authentication handshake must complete before any other messages can be sent",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:46.117Z"
        },
        {
          "id": 2,
          "text": "Connection state must be reflected in the Connection model and UI",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:47.173Z"
        },
        {
          "id": 3,
          "text": "Auto-reconnect with exponential backoff on connection loss (max 10 attempts)",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:48.181Z"
        },
        {
          "id": 4,
          "text": "Ping/pong heartbeat every 30 seconds to keep connection alive",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:49.030Z"
        },
        {
          "id": 5,
          "text": "Mobile sends 'auth' message with channel_id and optional api_key. Relay responds with 'auth_success' (including connected instances) or 'auth_error' with codes: INVALID_CHANNEL, INVALID_API_KEY, RATE_LIMITED",
          "deleted": false,
          "createdAt": "2026-02-19T01:55:37.654Z"
        },
        {
          "id": 6,
          "text": "INVALID_CHANNEL for bad channel ID, INVALID_API_KEY for bad API key - allows app to show specific error guidance",
          "deleted": false,
          "createdAt": "2026-02-19T01:56:08.104Z"
        },
        {
          "id": 7,
          "text": "Yes - persist last connected state and auto-connect on app launch",
          "deleted": false,
          "createdAt": "2026-02-19T01:56:09.043Z"
        }
      ],
      "nextRuleId": 8,
      "examples": [
        {
          "id": 0,
          "text": "User taps connect on a saved connection, sees 'Connecting...' indicator, then sees 'Connected' when auth succeeds",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:52.984Z"
        },
        {
          "id": 1,
          "text": "User connects with invalid API key, sees 'Authentication failed' error and connection stays disconnected",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:54.275Z"
        },
        {
          "id": 2,
          "text": "Network drops while connected, app shows 'Reconnecting...' and automatically retries",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:55.035Z"
        },
        {
          "id": 3,
          "text": "User manually disconnects from an active connection, status immediately shows 'Disconnected'",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:56.075Z"
        },
        {
          "id": 4,
          "text": "Reconnection fails after 10 attempts, app shows 'Connection failed - tap to retry' error",
          "deleted": false,
          "createdAt": "2026-02-19T01:52:57.293Z"
        }
      ],
      "nextExampleId": 5,
      "questions": [
        {
          "id": 0,
          "text": "@human: What is the exact authentication handshake protocol with the relay? Does mobile send channelId+apiKey on connect, and relay responds with 'connected' message?",
          "deleted": false,
          "createdAt": "2026-02-19T01:53:02.388Z",
          "selected": true,
          "answered": true,
          "answer": "Mobile sends 'auth' message with channel_id and optional api_key. Relay responds with 'auth_success' (including connected instances) or 'auth_error' with codes: INVALID_CHANNEL, INVALID_API_KEY, RATE_LIMITED"
        },
        {
          "id": 1,
          "text": "@human: What error message/code does the relay send for invalid channel ID vs invalid API key?",
          "deleted": false,
          "createdAt": "2026-02-19T01:53:03.469Z",
          "selected": true,
          "answered": true,
          "answer": "INVALID_CHANNEL for bad channel ID, INVALID_API_KEY for bad API key - allows app to show specific error guidance"
        },
        {
          "id": 2,
          "text": "@human: Should the mobile app persist the last connected state and auto-connect on launch?",
          "deleted": false,
          "createdAt": "2026-02-19T01:53:04.698Z",
          "selected": true,
          "answered": true,
          "answer": "Yes - persist last connected state and auto-connect on app launch"
        }
      ],
      "nextQuestionId": 3,
      "estimate": 5,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Enhance existing WebSocketManager with auth handshake - add sendAuth() method and handle auth_success/auth_error message types",
          "deleted": false,
          "createdAt": "2026-02-19T01:57:52.615Z"
        },
        {
          "id": 1,
          "text": "Create RelayConnectionService that wraps WebSocketManager and manages Connection model state via Riverpod",
          "deleted": false,
          "createdAt": "2026-02-19T01:57:56.900Z"
        },
        {
          "id": 2,
          "text": "Persist autoConnect flag in Connection model via ConnectionRepository (Hive) - restore on app launch",
          "deleted": false,
          "createdAt": "2026-02-19T01:58:01.014Z"
        },
        {
          "id": 3,
          "text": "Wire up to InstanceCard in dashboard - tap to connect/disconnect, show connection status badge",
          "deleted": false,
          "createdAt": "2026-02-19T01:58:04.735Z"
        }
      ],
      "nextNoteId": 4,
      "attachments": [
        "spec/attachments/MOBILE-004/ast-research-websocket-manager.md"
      ],
      "updated": "2026-02-19T02:10:46.828Z"
    },
    "MOBILE-005": {
      "id": "MOBILE-005",
      "title": "Kanban Board View",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:27.777Z",
      "updatedAt": "2026-02-19T02:45:45.707Z",
      "description": "Display the fspec Kanban board for a connected instance. Shows columns (Backlog, Specifying, Testing, Implementing, Validating, Done, Blocked) with work unit cards. Horizontal swipe between columns. Sends 'board' command via relay.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-004"
      ],
      "attachments": [
        "spec/attachments/MOBILE-005/kanban-board.png",
        "spec/attachments/MOBILE-005/ast-research-board-patterns.md"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T02:31:10.784Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T02:34:45.223Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T02:40:40.510Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T02:45:11.165Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T02:45:45.707Z"
        }
      ],
      "userStory": {
        "role": "mobile user",
        "action": "view my project's Kanban board",
        "benefit": "see work unit status across all workflow columns"
      },
      "rules": [
        {
          "id": 0,
          "text": "Board displays 7 columns: Backlog, Specifying, Testing, Implementing, Validating, Done, Blocked",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:26.853Z"
        },
        {
          "id": 1,
          "text": "Each column shows a count of work units it contains",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:27.584Z"
        },
        {
          "id": 2,
          "text": "Work unit cards display: ID, title, story points (if estimated), and type indicator",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:29.017Z"
        },
        {
          "id": 3,
          "text": "Type indicators: blue dot for story, orange dot for bug, green dot for task",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:29.730Z"
        },
        {
          "id": 4,
          "text": "Horizontal swipe navigates between columns with page indicators",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:30.641Z"
        },
        {
          "id": 5,
          "text": "Board data is fetched by sending 'board' command via WebSocket relay",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:31.577Z"
        },
        {
          "id": 6,
          "text": "Columns are vertically scrollable when content exceeds screen height",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:32.486Z"
        },
        {
          "id": 7,
          "text": "Yes, show a centered loading spinner while waiting for board data",
          "deleted": false,
          "createdAt": "2026-02-19T02:32:03.496Z"
        },
        {
          "id": 8,
          "text": "Yes, pull-to-refresh reloads board data - standard mobile pattern",
          "deleted": false,
          "createdAt": "2026-02-19T02:32:04.527Z"
        },
        {
          "id": 9,
          "text": "Show connection lost banner with retry option, keep displaying cached data",
          "deleted": false,
          "createdAt": "2026-02-19T02:32:05.664Z"
        }
      ],
      "nextRuleId": 10,
      "examples": [
        {
          "id": 0,
          "text": "User opens board and sees Backlog column with 12 work units, swipes left to see Specifying column",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:36.940Z"
        },
        {
          "id": 1,
          "text": "Work unit card shows 'AUTH-001' ID, 'Implement OAuth2 login flow' title, folder icon with '5 pts', and blue dot indicating story type",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:38.138Z"
        },
        {
          "id": 2,
          "text": "Bug work unit 'UI-103' displays with bug icon, '3 pts', and orange dot indicator",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:39.291Z"
        },
        {
          "id": 3,
          "text": "Task work unit 'API-204' displays with checkbox icon, '2 pts', and green dot indicator",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:40.260Z"
        },
        {
          "id": 4,
          "text": "Column with 15 work units is vertically scrollable; user scrolls down to see remaining cards",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:41.485Z"
        },
        {
          "id": 5,
          "text": "Board sends 'board' command via relay on load and receives JSON with column data",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:42.511Z"
        },
        {
          "id": 6,
          "text": "Work unit without estimate shows only ID, title, and type indicator (no points)",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:43.640Z"
        }
      ],
      "nextExampleId": 7,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Use PageView widget for horizontal column swiping with PageController",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:48.755Z"
        },
        {
          "id": 1,
          "text": "Create BoardNotifier extending AsyncNotifier to manage board state and relay communication",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:49.841Z"
        },
        {
          "id": 2,
          "text": "Work unit card is tappable to navigate to detail view (MOBILE-006)",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:50.912Z"
        }
      ],
      "nextNoteId": 3,
      "questions": [
        {
          "id": 0,
          "text": "Should we show a loading indicator while fetching board data?",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:51.894Z",
          "selected": true,
          "answered": true,
          "answer": "Yes, show a centered loading spinner while waiting for board data"
        },
        {
          "id": 1,
          "text": "Should we support pull-to-refresh to reload the board?",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:52.824Z",
          "selected": true,
          "answered": true,
          "answer": "Yes, pull-to-refresh reloads board data - standard mobile pattern"
        },
        {
          "id": 2,
          "text": "What happens if the WebSocket connection is lost while viewing the board?",
          "deleted": false,
          "createdAt": "2026-02-19T02:31:53.821Z",
          "selected": true,
          "answered": true,
          "answer": "Show connection lost banner with retry option, keep displaying cached data"
        }
      ],
      "nextQuestionId": 3,
      "estimate": 5,
      "updated": "2026-02-19T02:45:45.707Z"
    },
    "MOBILE-006": {
      "id": "MOBILE-006",
      "title": "Work Unit Detail View",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:29.540Z",
      "updatedAt": "2026-02-19T03:04:33.115Z",
      "description": "Display full work unit details including Example Mapping data. Shows ID, title, type, status, story points, user story, rules (blue), examples (green), questions (red), and architecture notes. Supports viewing but not editing in v1.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-005"
      ],
      "attachments": [
        "spec/attachments/MOBILE-006/work-unit-detail.png",
        "spec/attachments/MOBILE-006/ast-research-work-unit-detail.md"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T02:49:49.548Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T02:54:32.228Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T02:59:42.474Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T03:04:03.813Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T03:04:33.115Z"
        }
      ],
      "userStory": {
        "role": "mobile user",
        "action": "view full work unit details including Example Mapping data",
        "benefit": "understand the complete context of a story before working on it"
      },
      "rules": [
        {
          "id": 0,
          "text": "Header displays work unit ID, back navigation, and overflow menu",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:12.426Z"
        },
        {
          "id": 1,
          "text": "Status row shows type badge (Story/Bug/Task), status badge with icon, and story points",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:13.699Z"
        },
        {
          "id": 2,
          "text": "User story displays role, action, and benefit with keyword highlighting",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:14.511Z"
        },
        {
          "id": 3,
          "text": "Rules are displayed as blue-themed cards with count badge in section header",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:15.330Z"
        },
        {
          "id": 4,
          "text": "Examples are displayed as green-themed cards with type labels (HAPPY PATH, EDGE CASE) and count badge",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:16.254Z"
        },
        {
          "id": 5,
          "text": "Questions are displayed as red/pink-themed cards with @mention highlighting and count badge",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:16.964Z"
        },
        {
          "id": 6,
          "text": "Architecture notes section displays technical context for the work unit",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:17.986Z"
        },
        {
          "id": 7,
          "text": "v1 is view-only - no editing or adding capabilities",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:18.752Z"
        }
      ],
      "nextRuleId": 8,
      "examples": [
        {
          "id": 0,
          "text": "User taps work unit AUTH-001 from Kanban board → Detail view shows full Example Mapping with 2 rules, 2 examples, 1 question",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:22.835Z"
        },
        {
          "id": 1,
          "text": "Work unit has no user story set → User story section shows empty state or is hidden",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:23.722Z"
        },
        {
          "id": 2,
          "text": "Work unit has zero rules → Rules section header shows (0) badge, section is collapsed or shows empty state",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:25.097Z"
        },
        {
          "id": 3,
          "text": "Question contains @security-team mention → Mention text is highlighted in distinct color",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:26.014Z"
        },
        {
          "id": 4,
          "text": "Work unit is type Bug → Purple badge shows 'Bug' instead of 'Story'",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:27.137Z"
        },
        {
          "id": 5,
          "text": "Work unit has no estimate → Story points badge is hidden or shows dash",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:28.166Z"
        },
        {
          "id": 6,
          "text": "User presses back arrow → Returns to Kanban board view",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:29.191Z"
        }
      ],
      "nextExampleId": 7,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Fetch work unit details via WebSocket relay using existing connection infrastructure from MOBILE-004",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:35.358Z"
        },
        {
          "id": 1,
          "text": "Reuse color theming from Kanban board for type/status badges",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:36.361Z"
        },
        {
          "id": 2,
          "text": "Navigate to detail view by sending show-work-unit command via WebSocket relay",
          "deleted": false,
          "createdAt": "2026-02-19T02:50:59.814Z"
        }
      ],
      "nextNoteId": 3,
      "estimate": 5,
      "questions": [],
      "nextQuestionId": 0,
      "updated": "2026-02-19T03:04:33.115Z"
    },
    "MOBILE-007": {
      "id": "MOBILE-007",
      "title": "Session Stream Display",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:31.465Z",
      "updatedAt": "2026-02-19T03:47:36.593Z",
      "description": "Real-time display of AI session output. Shows StreamChunks: text responses, thinking blocks (collapsible), tool calls with input/output, and user messages. Subscribes to session via relay and handles chunk streaming.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-004"
      ],
      "attachments": [
        "spec/attachments/MOBILE-007/session-stream.png",
        "spec/attachments/MOBILE-007/ast-research-websocket-integration.md"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T03:19:09.960Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T03:22:02.032Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T03:38:01.842Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T03:47:23.001Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T03:47:36.593Z"
        }
      ],
      "userStory": {
        "role": "developer",
        "action": "view real-time AI session output on my mobile device",
        "benefit": "monitor what Claude is doing and follow along with the conversation"
      },
      "rules": [
        {
          "id": 0,
          "text": "Session header displays connection name, session ID, and running status indicator",
          "deleted": false,
          "createdAt": "2026-02-19T03:19:55.806Z"
        },
        {
          "id": 1,
          "text": "User messages display in purple bubbles with timestamps",
          "deleted": false,
          "createdAt": "2026-02-19T03:19:56.624Z"
        },
        {
          "id": 2,
          "text": "AI text responses display in labeled message bubbles",
          "deleted": false,
          "createdAt": "2026-02-19T03:19:57.554Z"
        },
        {
          "id": 3,
          "text": "Thinking blocks are collapsible and show step-by-step reasoning with progress indicators",
          "deleted": false,
          "createdAt": "2026-02-19T03:19:58.588Z"
        },
        {
          "id": 4,
          "text": "Tool calls display with tool name, status badge, input code block, and output",
          "deleted": false,
          "createdAt": "2026-02-19T03:19:59.594Z"
        },
        {
          "id": 5,
          "text": "Stream chunks arrive as WebSocket messages with type 'chunk' and must be parsed into typed models",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:00.603Z"
        },
        {
          "id": 6,
          "text": "Session state changes (Running/Idle/Paused) update the header status indicator",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:01.654Z"
        },
        {
          "id": 7,
          "text": "Emergency Interrupt button is always visible at the bottom of the screen",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:02.784Z"
        }
      ],
      "nextRuleId": 8,
      "examples": [
        {
          "id": 0,
          "text": "User sends 'Refactor the login logic' and sees it appear in a purple bubble with timestamp",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:07.482Z"
        },
        {
          "id": 1,
          "text": "AI starts thinking and user sees collapsible 'Thinking Process' block with live progress steps",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:08.814Z"
        },
        {
          "id": 2,
          "text": "AI runs grep command and user sees TOOL: BASH block with command input and file path output",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:10.259Z"
        },
        {
          "id": 3,
          "text": "Tool completes and status badge changes from 'running' to 'completed'",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:11.395Z"
        },
        {
          "id": 4,
          "text": "AI responds with text and user sees labeled 'DevBot' response bubble",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:12.393Z"
        },
        {
          "id": 5,
          "text": "Session changes from Running to Idle when AI completes response",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:13.345Z"
        },
        {
          "id": 6,
          "text": "User taps collapsed thinking block and it expands to show all thinking steps",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:14.359Z"
        },
        {
          "id": 7,
          "text": "New chunks stream in and auto-scroll keeps the latest content visible",
          "deleted": false,
          "createdAt": "2026-02-19T03:20:15.805Z"
        }
      ],
      "nextExampleId": 8,
      "estimate": 5,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Creates new feature folder lib/features/session/ with presentation layer (SessionStreamScreen, chunk widgets) and data layer (session providers, stream chunk models)",
          "deleted": false,
          "createdAt": "2026-02-19T03:21:13.330Z"
        },
        {
          "id": 1,
          "text": "Subscribes to existing WebSocketManager.messageStream (from MOBILE-004), filtering for MessageType.chunk messages",
          "deleted": false,
          "createdAt": "2026-02-19T03:21:14.702Z"
        },
        {
          "id": 2,
          "text": "StreamChunk type hierarchy: text, thinking, toolCall, toolResult, toolProgress, sessionStateChange, done, error - each maps to a dedicated widget",
          "deleted": false,
          "createdAt": "2026-02-19T03:21:16.025Z"
        }
      ],
      "nextNoteId": 3,
      "questions": [],
      "nextQuestionId": 0,
      "updated": "2026-02-19T03:47:36.593Z"
    },
    "MOBILE-008": {
      "id": "MOBILE-008",
      "title": "Input Injection",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:33.604Z",
      "updatedAt": "2026-02-19T04:04:04.145Z",
      "description": "Send text messages and images to an active fspec session. Input field at bottom of session stream view with send button and camera icon for image attachment. Messages sent via 'input' message type to relay.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-007"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T03:52:59.554Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T03:56:07.249Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T03:58:05.646Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T04:03:12.316Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T04:04:04.145Z"
        }
      ],
      "userStory": {
        "role": "mobile user",
        "action": "send text messages and images to an active fspec session",
        "benefit": "communicate with the AI and provide context"
      },
      "rules": [
        {
          "id": 0,
          "text": "Input field appears at the bottom of the session stream view",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:30.593Z"
        },
        {
          "id": 1,
          "text": "Text messages are sent via the 'input' message type to the relay",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:31.355Z"
        },
        {
          "id": 2,
          "text": "Send button is enabled only when text field is not empty",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:32.375Z"
        },
        {
          "id": 3,
          "text": "Camera icon opens platform image picker (camera or gallery)",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:33.171Z"
        },
        {
          "id": 4,
          "text": "Images are base64-encoded with media type before sending",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:34.004Z"
        },
        {
          "id": 5,
          "text": "Input field clears after successful send",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:34.848Z"
        },
        {
          "id": 6,
          "text": "Keyboard adjusts layout so input field remains visible",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:35.852Z"
        }
      ],
      "nextRuleId": 7,
      "examples": [
        {
          "id": 0,
          "text": "User types 'Implement the login feature' and taps send → message appears in stream and relay receives input message",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:46.628Z"
        },
        {
          "id": 1,
          "text": "User taps camera icon → image picker appears with camera and gallery options",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:46.723Z"
        },
        {
          "id": 2,
          "text": "User selects photo and types description → both image (base64) and text sent to relay",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:46.809Z"
        },
        {
          "id": 3,
          "text": "User with empty text field sees disabled send button",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:47.007Z"
        },
        {
          "id": 4,
          "text": "User opens keyboard → input field scrolls up to remain visible above keyboard",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:47.151Z"
        },
        {
          "id": 5,
          "text": "User attaches multiple images → thumbnail preview shows all selected images",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:47.299Z"
        },
        {
          "id": 6,
          "text": "User taps X on image thumbnail → image removed from pending attachments",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:47.556Z"
        }
      ],
      "nextExampleId": 7,
      "architectureNotes": [
        {
          "id": 0,
          "text": "WebSocketManager.sendInput() already exists - accepts message and optional images array",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:51.899Z"
        },
        {
          "id": 1,
          "text": "Use image_picker package for camera/gallery access",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:52.818Z"
        },
        {
          "id": 2,
          "text": "Create InputBarWidget at bottom of SessionStreamScreen body Column",
          "deleted": false,
          "createdAt": "2026-02-19T03:53:53.949Z"
        }
      ],
      "nextNoteId": 3,
      "estimate": 5,
      "attachments": [
        "spec/attachments/MOBILE-008/ast-research-input-injection.md"
      ],
      "questions": [],
      "nextQuestionId": 0,
      "updated": "2026-02-19T04:04:04.145Z"
    },
    "MOBILE-009": {
      "id": "MOBILE-009",
      "title": "Session Control",
      "type": "story",
      "status": "done",
      "createdAt": "2026-02-19T00:08:35.230Z",
      "updatedAt": "2026-02-19T04:46:35.760Z",
      "description": "Control active fspec sessions with interrupt and clear commands. Emergency interrupt button prominently displayed. Commands sent via 'session_control' message type to relay.",
      "epic": "mobile-core",
      "children": [],
      "dependsOn": [
        "MOBILE-007"
      ],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T04:22:16.570Z"
        },
        {
          "state": "testing",
          "timestamp": "2026-02-19T04:41:00.889Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T04:43:58.544Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T04:46:11.069Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T04:46:35.760Z"
        }
      ],
      "userStory": {
        "role": "mobile app user",
        "action": "control active fspec sessions with interrupt and clear commands",
        "benefit": "manage AI execution and start fresh when needed"
      },
      "rules": [
        {
          "id": 0,
          "text": "Emergency interrupt button sends 'interrupt' action via session_control message type",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:11.046Z"
        },
        {
          "id": 1,
          "text": "Clear button sends 'clear' action via session_control message type",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:11.788Z"
        },
        {
          "id": 2,
          "text": "Session control messages are fire-and-forget (no response expected)",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:12.579Z"
        },
        {
          "id": 3,
          "text": "Emergency interrupt button is prominently displayed in red",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:13.476Z"
        },
        {
          "id": 4,
          "text": "Session control messages include session_id to target the correct session",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:14.536Z"
        },
        {
          "id": 5,
          "text": "Header overflow menu (⋮) - three dots in header, contains Clear Session option",
          "deleted": false,
          "createdAt": "2026-02-19T04:39:02.994Z"
        },
        {
          "id": 6,
          "text": "Yes - show confirmation dialog before clearing (destructive action)",
          "deleted": false,
          "createdAt": "2026-02-19T04:39:27.440Z"
        }
      ],
      "nextRuleId": 7,
      "examples": [
        {
          "id": 0,
          "text": "User taps red EMERGENCY INTERRUPT button → sends session_control with action='interrupt'",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:19.458Z"
        },
        {
          "id": 1,
          "text": "User taps Clear Session option → sends session_control with action='clear'",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:20.143Z"
        },
        {
          "id": 2,
          "text": "User taps interrupt while WebSocket is disconnected → shows error/no-op",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:21.404Z"
        },
        {
          "id": 3,
          "text": "Emergency interrupt button visible above input bar on session stream screen",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:22.750Z"
        }
      ],
      "nextExampleId": 4,
      "questions": [
        {
          "id": 0,
          "text": "Where should the Clear Session option be located? Header menu? Separate button?",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:28.639Z",
          "selected": true,
          "answered": true,
          "answer": "Header overflow menu (⋮) - three dots in header, contains Clear Session option"
        },
        {
          "id": 1,
          "text": "Should there be a confirmation dialog before clearing the session?",
          "deleted": false,
          "createdAt": "2026-02-19T04:23:29.492Z",
          "selected": true,
          "answered": true,
          "answer": "Yes - show confirmation dialog before clearing (destructive action)"
        }
      ],
      "nextQuestionId": 2,
      "estimate": 3,
      "architectureNotes": [
        {
          "id": 0,
          "text": "Uses existing WebSocketManager.sendSessionControl() method for fire-and-forget messages",
          "deleted": false,
          "createdAt": "2026-02-19T04:40:16.333Z"
        },
        {
          "id": 1,
          "text": "Header overflow menu via PopupMenuButton - Clear Session option with confirmation AlertDialog",
          "deleted": false,
          "createdAt": "2026-02-19T04:40:20.773Z"
        },
        {
          "id": 2,
          "text": "EmergencyInterruptButton already exists and is wired up - just needs test coverage",
          "deleted": false,
          "createdAt": "2026-02-19T04:40:22.354Z"
        }
      ],
      "nextNoteId": 3,
      "attachments": [
        "spec/attachments/MOBILE-009/ast-research-session-control.md"
      ],
      "updated": "2026-02-19T04:46:35.760Z"
    },
    "DEV-001": {
      "id": "DEV-001",
      "title": "Fake Relay Server for Manual Testing",
      "type": "task",
      "status": "done",
      "createdAt": "2026-02-19T04:52:43.953Z",
      "updatedAt": "2026-02-19T07:08:06.562Z",
      "description": "Create a standalone fake relay server that simulates the fspec relay protocol. Should support: auth handshake (auth_success with mock instances), board command responses, work unit details, session streaming with mock AI output (text chunks, thinking blocks, tool calls), input injection echo, and session control commands (interrupt/clear). Run via 'dart run tools/fake_relay.dart' or npm script. Allows manual testing of all app screens without a real fspec instance.",
      "children": [],
      "stateHistory": [
        {
          "state": "specifying",
          "timestamp": "2026-02-19T04:54:55.648Z"
        },
        {
          "state": "implementing",
          "timestamp": "2026-02-19T04:55:00.542Z"
        },
        {
          "state": "validating",
          "timestamp": "2026-02-19T07:07:23.288Z"
        },
        {
          "state": "done",
          "timestamp": "2026-02-19T07:08:06.562Z"
        }
      ],
      "estimate": 3,
      "rules": [],
      "examples": [],
      "questions": [],
      "architectureNotes": [],
      "nextRuleId": 0,
      "nextExampleId": 0,
      "nextQuestionId": 0,
      "nextNoteId": 0,
      "updated": "2026-02-19T07:08:06.562Z"
    }
  },
  "states": {
    "backlog": [],
    "specifying": [],
    "testing": [],
    "implementing": [],
    "validating": [],
    "done": [
      "DEV-001",
      "MOBILE-009",
      "MOBILE-008",
      "MOBILE-007",
      "MOBILE-006",
      "MOBILE-005",
      "MOBILE-004",
      "MOBILE-003",
      "MOBILE-002",
      "MOBILE-001",
      "DESIGN-001",
      "SETUP-001",
      "FOUND-001"
    ],
    "blocked": []
  },
  "prefixCounters": {
    "SETUP": 1,
    "DESIGN": 1,
    "MOBILE": 9,
    "DEV": 1
  }
}